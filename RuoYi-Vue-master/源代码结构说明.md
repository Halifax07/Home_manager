# RuoYi-Vue 家庭财务管理系统源代码结构说明

## 项目概述

RuoYi-Vue家庭财务管理系统是一个基于Spring Boot + Vue.js的前后端分离项目，采用Maven多模块架构，实现了完整的家庭财务管理功能，包括用户认证、家庭成员管理、收支记录、统计分析等核心模块。

## 整体架构

```
RuoYi-Vue-master/
├── pom.xml                          # 父级POM文件，管理依赖版本
├── bin/                            # 构建脚本
│   ├── clean.bat                   # 清理脚本
│   ├── package.bat                 # 打包脚本
│   └── run.bat                     # 运行脚本
├── sql/                            # 数据库脚本
│   ├── family_management.sql       # 家庭管理相关表结构
│   ├── family_register_setup.sql   # 家庭注册设置
│   ├── quartz.sql                  # 定时任务相关表
│   └── ry_20250522.sql            # 系统基础表结构
├── ruoyi-admin/                    # 主启动模块（Web层）
├── ruoyi-common/                   # 公共模块
├── ruoyi-framework/                # 框架核心模块
├── ruoyi-system/                   # 系统模块（Service层）
├── ruoyi-quartz/                   # 定时任务模块
├── ruoyi-families/                 # 家庭管理模块
├── ruoyi-transactions/             # 交易记录模块
├── ruoyi-users/                    # 用户管理模块
└── ruoyi-ui/                      # 前端Vue项目
```

## 核心模块详解

### 1. 用户认证与授权模块

#### 后端实现

**核心文件结构：**
```
ruoyi-framework/src/main/java/com/ruoyi/framework/
├── security/                       # Spring Security配置
│   ├── handle/
│   │   └── AuthenticationEntryPointImpl.java  # 认证入口点
│   └── context/
│       └── AuthenticationContextHolder.java   # 认证上下文
├── web/service/
│   ├── SysLoginService.java       # 登录服务
│   ├── SysRegisterService.java    # 注册服务
│   └── SysPermissionService.java  # 权限服务
└── config/
    └── SecurityConfig.java        # 安全配置

ruoyi-admin/src/main/java/com/ruoyi/web/controller/system/
├── SysLoginController.java        # 登录控制器
└── SysRegisterController.java     # 注册控制器

ruoyi-system/src/main/java/com/ruoyi/system/
├── service/
│   ├── ISysUserService.java       # 用户服务接口
│   ├── ISysRoleService.java       # 角色服务接口
│   └── impl/
│       ├── SysUserServiceImpl.java    # 用户服务实现
│       └── SysRoleServiceImpl.java    # 角色服务实现
├── mapper/
│   ├── SysUserMapper.java         # 用户数据访问层
│   └── SysRoleMapper.java         # 角色数据访问层
└── domain/
    ├── entity/
    │   ├── SysUser.java           # 用户实体
    │   └── SysRole.java           # 角色实体
    └── SysUserRole.java           # 用户角色关联
```

**关键代码功能说明：**

1. **SysLoginController.java** - 登录验证控制器
   - `login()`: 处理用户登录请求，验证用户名密码
   - `getInfo()`: 获取当前登录用户信息
   - `getRouters()`: 获取用户可访问的路由菜单

2. **SysRegisterService.java** - 注册服务
   - `register()`: 用户注册逻辑，创建家庭注册申请
   - `validateCaptcha()`: 验证码校验

3. **SysUserServiceImpl.java** - 用户服务实现
   - 用户CRUD操作
   - 密码加密验证
   - 用户状态管理

#### 前端实现

**核心文件结构：**
```
ruoyi-ui/src/
├── views/
│   ├── login.vue                  # 登录页面
│   └── register.vue               # 注册页面
├── store/modules/
│   ├── user.js                    # 用户状态管理
│   └── permission.js              # 权限状态管理
├── router/
│   └── index.js                   # 路由配置
└── utils/
    ├── auth.js                    # 认证工具
    └── permission.js              # 权限控制
```

### 2. 家庭成员管理模块

#### 后端实现

**核心文件结构：**
```
ruoyi-system/src/main/java/com/ruoyi/system/
├── domain/
│   ├── FamilyMembers.java         # 家庭成员实体
│   ├── FamilyRegister.java        # 家庭注册实体
│   └── Families.java              # 家庭信息实体
├── service/
│   ├── IFamilyMembersService.java # 家庭成员服务接口
│   ├── IFamilyRegisterService.java # 家庭注册服务接口
│   └── impl/
│       ├── FamilyMembersServiceImpl.java    # 家庭成员服务实现
│       └── FamilyRegisterServiceImpl.java   # 家庭注册服务实现
└── mapper/
    ├── FamilyMembersMapper.java   # 家庭成员数据访问
    └── FamilyRegisterMapper.java  # 家庭注册数据访问

ruoyi-admin/src/main/java/com/ruoyi/web/controller/family/
├── FamilyMembersController.java   # 家庭成员控制器
└── FamilyRegisterController.java  # 家庭注册控制器
```

**关键代码功能说明：**

1. **FamilyMembersController.java** - 家庭成员管理控制器
   - `list()`: 查询家庭成员列表
   - `add()`: 添加家庭成员
   - `edit()`: 编辑家庭成员信息
   - `remove()`: 删除家庭成员

2. **FamilyRegisterServiceImpl.java** - 家庭注册服务实现
   - `approveRegister()`: 审批家庭注册申请
   - 自动创建sys_user和family_members记录
   - 分配家庭管理员和普通成员角色

#### 前端实现

**核心文件结构：**
```
ruoyi-ui/src/views/family/
├── members/
│   └── index.vue                  # 家庭成员管理页面
├── personal/
│   └── index.vue                  # 个人信息页面
└── dashboard/
    └── index.vue                  # 家庭仪表板
```

### 3. 收支记录模块

#### 后端实现

**核心文件结构：**
```
ruoyi-system/src/main/java/com/ruoyi/system/
├── domain/
│   └── Transactions.java          # 交易记录实体
├── service/
│   ├── ITransactionsService.java  # 交易服务接口
│   └── impl/
│       └── TransactionsServiceImpl.java  # 交易服务实现
└── mapper/
    └── TransactionsMapper.java    # 交易数据访问层

ruoyi-admin/src/main/java/com/ruoyi/web/controller/family/
└── TransactionsController.java    # 交易控制器
```

**关键代码功能说明：**

1. **TransactionsController.java** - 交易记录控制器
   - `list()`: 查询交易记录列表（支持按用户权限过滤）
   - `add()`: 添加交易记录
   - `edit()`: 编辑交易记录（仅允许编辑自己的记录）
   - `remove()`: 删除交易记录（仅允许删除自己的记录）

2. **TransactionsServiceImpl.java** - 交易服务实现
   - 实现交易记录的CRUD操作
   - 支持按家庭成员过滤数据
   - 数据权限控制

3. **TransactionsMapper.xml** - MyBatis映射文件
   - 包含memberName过滤的SQL查询
   - 支持动态条件查询

#### 前端实现

**核心文件结构：**
```
ruoyi-ui/src/views/family/transactions/
└── index.vue                      # 交易记录管理页面
```

**关键功能：**
- 收支记录列表展示
- 条件查询和分页
- 新增/编辑/删除交易记录
- 根据用户权限显示操作按钮
- 普通用户只能操作自己的记录

### 4. 统计分析模块

#### 后端实现

**核心文件结构：**
```
ruoyi-system/src/main/java/com/ruoyi/system/
├── service/
│   ├── IStatisticsService.java    # 统计服务接口
│   └── impl/
│       └── StatisticsServiceImpl.java  # 统计服务实现

ruoyi-admin/src/main/java/com/ruoyi/web/controller/family/
└── StatisticsController.java      # 统计控制器
```

**关键代码功能说明：**

1. **StatisticsController.java** - 统计分析控制器
   - 收支统计图表数据
   - 月度/年度报表
   - 分类统计分析

2. **StatisticsServiceImpl.java** - 统计服务实现
   - 复杂统计查询逻辑
   - 数据聚合计算
   - 图表数据格式化

#### 前端实现

**核心文件结构：**
```
ruoyi-ui/src/views/family/statistics/
└── index.vue                      # 统计分析页面
```

**关键功能：**
- ECharts图表展示
- 收支趋势分析
- 分类统计饼图
- 数据导出功能

## 技术架构说明

### 后端技术栈
- **Spring Boot 2.5.15** - 主框架
- **Spring Security** - 安全框架
- **MyBatis** - ORM框架
- **MySQL** - 数据库
- **Redis** - 缓存
- **JWT** - 身份验证
- **Quartz** - 定时任务

### 前端技术栈
- **Vue.js 2.x** - 前端框架
- **Element UI** - UI组件库
- **Axios** - HTTP请求库
- **Vue Router** - 路由管理
- **Vuex** - 状态管理
- **ECharts** - 图表库

### 数据库设计

**核心表结构：**
```sql
-- 系统用户表（登录认证）
sys_user (user_id, user_name, password, status, roles...)

-- 家庭成员表（业务逻辑）
family_members (id, account, name, phone, family_id, role...)

-- 家庭注册表（注册申请）
family_register (id, account, phone, status, family_name...)

-- 交易记录表
transactions (id, member_name, amount, type, category, date...)

-- 权限相关表
sys_role (角色表)
sys_menu (菜单表)
sys_user_role (用户角色关联)
sys_role_menu (角色菜单关联)
```

## 权限控制机制

### 双表认证系统
1. **sys_user表** - 用于登录验证和Spring Security认证
2. **family_members表** - 用于业务逻辑和数据权限控制

### 角色权限设计
- **family_admin (100L)** - 家庭管理员，可查看和管理所有家庭数据
- **family_member (101L)** - 普通成员，只能查看和管理自己的数据

### 数据权限实现
- 通过memberName字段进行数据权限过滤
- 前端根据用户角色控制按钮显示
- 后端通过方法级权限控制数据访问

## 部署说明

### 开发环境启动
1. **后端启动**：`java -jar ruoyi-admin/target/ruoyi-admin.jar`
2. **前端启动**：`npm run dev` (在ruoyi-ui目录下)

### 生产环境部署
1. **后端**：Maven打包后部署Spring Boot JAR文件
2. **前端**：`npm run build:prod` 后部署到Web服务器
3. **数据库**：执行sql目录下的初始化脚本

## 项目特色功能

1. **家庭化管理** - 支持多家庭、多成员的财务管理
2. **权限细化** - 普通成员只能管理自己的数据，管理员可管理全家数据
3. **注册审批** - 新用户注册后自动审批并分配权限
4. **数据统计** - 丰富的图表和统计分析功能
5. **响应式设计** - 支持PC和移动端访问

这个系统很好地展示了前后端分离架构的实现，以及复杂权限控制和业务逻辑的处理方式。
